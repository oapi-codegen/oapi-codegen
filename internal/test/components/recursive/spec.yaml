openapi: "3.0.2"
info:
  version: 1.0.0
  title: Recursive Types
  description: Tests recursive/cyclic schema references
paths:
  /documents:
    get:
      operationId: getDocument
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
  /filters:
    get:
      operationId: getFilter
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FilterColumnIncludes"
components:
  schemas:
    # From issue-52: Document → Value → ArrayValue → Value (simple recursion)
    Document:
      type: object
      properties:
        fields:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/Value"
    Value:
      type: object
      properties:
        stringValue:
          type: string
        arrayValue:
          $ref: "#/components/schemas/ArrayValue"
    ArrayValue:
      type: array
      items:
        $ref: "#/components/schemas/Value"

    # From issue-936: Deep cyclic oneOf references
    FilterColumnIncludes:
      type: object
      properties:
        $includes:
          $ref: "#/components/schemas/FilterPredicate"
      additionalProperties: false
    FilterPredicate:
      oneOf:
        - $ref: "#/components/schemas/FilterValue"
        - type: array
          items:
            $ref: "#/components/schemas/FilterPredicate"
        - $ref: "#/components/schemas/FilterPredicateOp"
        - $ref: "#/components/schemas/FilterPredicateRangeOp"
    FilterPredicateOp:
      type: object
      properties:
        $any:
          oneOf:
            - type: array
              items:
                $ref: "#/components/schemas/FilterPredicate"
        $none:
          oneOf:
            - $ref: "#/components/schemas/FilterPredicate"
            - type: array
              items:
                $ref: "#/components/schemas/FilterPredicate"
      additionalProperties: false
    FilterPredicateRangeOp:
      type: object
      properties:
        $lt:
          $ref: "#/components/schemas/FilterRangeValue"
      additionalProperties: false
    FilterRangeValue:
      oneOf:
        - type: number
        - type: string
    FilterValue:
      oneOf:
        - type: number
        - type: string
        - type: boolean
