{{/* Simple initiator template - wraps Initiator with typed responses for simple operations */}}
{{/* Input: InitiatorTemplateData */}}

// {{ .Prefix }}HttpError represents an HTTP error response.
// The type parameter E is the type of the parsed error body.
type {{ .Prefix }}HttpError[E any] struct {
	StatusCode int
	Body       E
	RawBody    []byte
}

func (e *{{ .Prefix }}HttpError[E]) Error() string {
	return fmt.Sprintf("HTTP %d", e.StatusCode)
}

// Simple{{ .Prefix }}Initiator wraps {{ .Prefix }}Initiator with typed responses for operations that have
// unambiguous response types. Methods return the success type directly,
// and HTTP errors are returned as *{{ .Prefix }}HttpError[E] where E is the error type.
type Simple{{ .Prefix }}Initiator struct {
	*{{ .Prefix }}Initiator
}

// NewSimple{{ .Prefix }}Initiator creates a new Simple{{ .Prefix }}Initiator which wraps a {{ .Prefix }}Initiator.
func NewSimple{{ .Prefix }}Initiator(opts ...{{ .Prefix }}InitiatorOption) (*Simple{{ .Prefix }}Initiator, error) {
	initiator, err := New{{ .Prefix }}Initiator(opts...)
	if err != nil {
		return nil, err
	}
	return &Simple{{ .Prefix }}Initiator{ {{ .Prefix }}Initiator: initiator}, nil
}

{{- range .Operations }}
{{- $op := . }}
{{- $opid := .GoOperationID }}
{{- $hasParams := .HasParams }}
{{- $paramsTypeName := .ParamsTypeName }}
{{- $prefix := $.Prefix }}
{{- $prefixLower := $.PrefixLower }}

{{- /* Determine if this operation is "simple" - single success content type, single JSON success response */}}
{{- $simpleOp := isSimpleOperation . }}
{{- if $simpleOp }}
{{- $successResponse := simpleOperationSuccessResponse . }}
{{- $successContent := index $successResponse.Contents 0 }}
{{- $successType := goTypeForContent $successContent }}
{{- $errorResponse := errorResponseForOperation . }}

// {{ $opid }} sends a {{ .Method }} {{ $prefixLower }} request and returns the parsed response.
{{ if .Summary }}// {{ .Summary }}{{ end }}
{{- if $errorResponse }}
{{- $errorContent := index $errorResponse.Contents 0 }}
{{- $errorType := goTypeForContent $errorContent }}
// On success, returns the response body. On HTTP error, returns *{{ $prefix }}HttpError[{{ $errorType }}].
func (p *Simple{{ $prefix }}Initiator) {{ $opid }}(ctx context.Context, targetURL string{{ if $hasParams }}, params *{{ $paramsTypeName }}{{ end }}{{ if .HasBody }}, body {{ (index .Bodies 0).GoTypeName }}{{ end }}, reqEditors ...RequestEditorFn) ({{ $successType }}, error) {
	var result {{ $successType }}
{{- if .HasBody }}
{{- $defaultBody := index .Bodies 0 }}
	resp, err := p.{{ $prefix }}Initiator.{{ $opid }}{{ $defaultBody.FuncSuffix }}(ctx, targetURL{{ if $hasParams }}, params{{ end }}, body, reqEditors...)
{{- else }}
	resp, err := p.{{ $prefix }}Initiator.{{ $opid }}(ctx, targetURL{{ if $hasParams }}, params{{ end }}, reqEditors...)
{{- end }}
	if err != nil {
		return result, err
	}
	defer resp.Body.Close()

	rawBody, err := io.ReadAll(resp.Body)
	if err != nil {
		return result, err
	}

	if resp.StatusCode >= 200 && resp.StatusCode < 300 {
		if err := json.Unmarshal(rawBody, &result); err != nil {
			return result, err
		}
		return result, nil
	}

	// Parse error response
	var errBody {{ $errorType }}
	_ = json.Unmarshal(rawBody, &errBody) // Best effort parse
	return result, &{{ $prefix }}HttpError[{{ $errorType }}]{
		StatusCode: resp.StatusCode,
		Body:       errBody,
		RawBody:    rawBody,
	}
}
{{- else }}
// On success, returns the response body. On HTTP error, returns *{{ $prefix }}HttpError[struct{}].
func (p *Simple{{ $prefix }}Initiator) {{ $opid }}(ctx context.Context, targetURL string{{ if $hasParams }}, params *{{ $paramsTypeName }}{{ end }}{{ if .HasBody }}, body {{ (index .Bodies 0).GoTypeName }}{{ end }}, reqEditors ...RequestEditorFn) ({{ $successType }}, error) {
	var result {{ $successType }}
{{- if .HasBody }}
{{- $defaultBody := index .Bodies 0 }}
	resp, err := p.{{ $prefix }}Initiator.{{ $opid }}{{ $defaultBody.FuncSuffix }}(ctx, targetURL{{ if $hasParams }}, params{{ end }}, body, reqEditors...)
{{- else }}
	resp, err := p.{{ $prefix }}Initiator.{{ $opid }}(ctx, targetURL{{ if $hasParams }}, params{{ end }}, reqEditors...)
{{- end }}
	if err != nil {
		return result, err
	}
	defer resp.Body.Close()

	rawBody, err := io.ReadAll(resp.Body)
	if err != nil {
		return result, err
	}

	if resp.StatusCode >= 200 && resp.StatusCode < 300 {
		if err := json.Unmarshal(rawBody, &result); err != nil {
			return result, err
		}
		return result, nil
	}

	// No typed error response defined
	return result, &{{ $prefix }}HttpError[struct{}]{
		StatusCode: resp.StatusCode,
		RawBody:    rawBody,
	}
}
{{- end }}
{{- end }}
{{- end }}
